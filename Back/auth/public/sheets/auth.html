<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth</title>
    <link rel="stylesheet" href="../styles/reset.css">
    <link rel="stylesheet" href="../styles/style.css">
</head>
<body>
    <section class="header">
        <div class="container">
            <nav class="top-menu">
                <div class="logo">
                    <img class="img-top-menu" src="../img/LogoVarCar.svg" alt="">
                </div>
                <div class="search-block">
                    <input type="text" placeholder="Хуй">
                </div>
                <div class="btn-top-menu">
                    <div class="btn-block-top-menu">
                        <button>
                            <img class="img-top-menu" src="../img/heart.svg" alt="">
                            Избранное
                        </button>
                    </div>
                    <div class="btn-block-top-menu">
                        <button>
                            <img class="img-top-menu" src="../img/left_right_arrows_arrows_icon_253898_1.svg" alt="">
                            Сравнение
                        </button>
                    </div>
                    <div class="btn-block-top-menu">
                        <button>
                            <img class="img-top-menu" src="../img/file_press_article_newsletter_newspaper_document_icon_251842_1.svg" alt="">
                            Статьи
                        </button>
                    </div>
                    <div class="btn-block-top-menu">
                        <button>
                            <img class="img-top-menu" src="../img/Plus.svg" alt="">
                            Разместить объявление
                        </button>
                    </div>
                </div>
                <div class="profile">
                    <img class="img-top-menu" src="../img/ProfileRace.svg" alt="">
                </div>
            </nav>
        </div>
    </section>
    <section class="registr">
        <div class="registr-window">
            <div class="registr-logo">
                <img src="../img/LogoVarCar.svg" alt="Logo">
            </div>
            <div class="name-block">
                <h1>Вход\Регистрация</h1>
            </div>
            <form class="registr-form" method="post">
                <div class="nameProfile-block">
                    <input type="text" name="nameProfile" placeholder="nameProfile" maxlength="35">
                </div>
                <div class="email-block">
                    <input type="text" name="email" placeholder="Email" maxlength="35">
                </div>
                <div class="password-block">
                    <input type="password" name="password" placeholder="Password" maxlength="35">
                </div>
                <div class="btn-block">
                    <button type="submit">Далее</button>
                </div>
            </form>
        </div>
    </section>

    
    <section class="window-message-all" style="display: none;">
        <div class="window-message">
            <div class="type-of-message">
                <span></span>
            </div>
            <div class="message">
                <p></p>
            </div>
        </div>
    </section>

    <script>
        document.querySelector('.registr-form').addEventListener('submit', async (event) => {
            event.preventDefault(); // Предотвращаем стандартную отправку формы
        
            // Получаем элементы ввода
            const nameProfileInput = document.querySelector('input[name="nameProfile"]');
            const emailInput = document.querySelector('input[name="email"]');
            const passwordInput = document.querySelector('input[name="password"]');
        
            // Получаем значения полей
            const name = nameProfileInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
        
            // Валидация данных
            if (!name || !email || !password) {
                showMessage('Fail:(', 'Все поля обязательны для заполнения');
                return;
            }
            if (!validateEmail(email)) {
                showMessage('Fail:(', 'Неверный формат email');
                return;
            }
            if (password.length < 6) {
                showMessage('Fail:(', 'Пароль должен быть не менее 6 символов');
                return;
            }
        
            // Отправка данных на сервер
            try {
                const response = await fetch('http://localhost:5500/users/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password }),
                });
                const data = await response.json();
        
                if (response.ok) {
                    showMessage('Success!', 'Регистрация успешна');
                    // Здесь можно добавить перенаправление или очистку формы
                } else {
                    showMessage('Fail:(', data.error || 'Ошибка регистрации');
                }
            } catch (error) {
                showMessage('Fail:(', 'Ошибка сервера');
            }
        });
        
        // Функция для показа сообщения
        function showMessage(type, message) {
            const messageWindow = document.querySelector('.window-message-all');
            const typeSpan = document.querySelector('.type-of-message span');
            const messageP = document.querySelector('.message p');
        
            typeSpan.textContent = type;
            messageP.textContent = message;
            messageWindow.style.display = 'flex';
        
            // Закрытие окна при клике вне его
            messageWindow.addEventListener('click', (event) => {
                if (event.target === messageWindow) {
                    messageWindow.style.display = 'none';
                }
            });
        }
        
        // Функция для валидации email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        </script>
    <!-- <script type="module" src="../../js/Front/authValid&API/main.js"></script> -->
</body>
</html>